{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Fractal Web Client","text":""},{"location":"#fractal","title":"Fractal","text":"<p>Fractal is a framework developed at the BioVisionCenter to process bioimaging data at scale in the OME-Zarr format and prepare the images for interactive visualization.</p> <p></p> <p>This is the repository that contains the Fractal web client. Find more information about Fractal in general and the other repositories at the Fractal home page.</p>"},{"location":"#web-client-architecture","title":"Web client architecture","text":"<p>The client is a Svelte application that uses SvelteKit as a framework. The application is composed of a set of pages that are rendered by a node server and served to a client browser. The node server acts as a proxy to the fractal server, forwarding the requests to the server and returning the responses to the client. Find more details in specific pages.</p>"},{"location":"#license-and-contributors","title":"License and contributors","text":"<p>The Fractal project is developed by the BioVisionCenter at the University of Zurich, who contracts eXact lab s.r.l. for software engineering and development support.</p> <p>Unless otherwise specified, Fractal components are released under the BSD 3-Clause License, and copyright is with the BioVisionCenter at the University of Zurich.</p>"},{"location":"changelog/","title":"CHANGELOG","text":"<p>Note: Numbers like (#123) point to closed Pull Requests on the fractal-web repository.</p>"},{"location":"changelog/#1240-unreleased","title":"1.24.0 (unreleased)","text":"<ul> <li>Support new backend API for workflow imports, with flexible version matching (#941).</li> <li>Added new cases of valid SLURM errors (#950).</li> <li>Add link to Job list page in no-history Workflow warning message (#966).</li> <li>Expand some user-facing messages (#972).</li> <li>JSON Schema form improvements (#957):<ul> <li>displayed error messages near the invalid elements;</li> <li>displayed unexpected properties, with the possibility to fix them;</li> <li>avoided duplication of discriminator properties;</li> <li>various fixes;</li> </ul> </li> <li>Simplified task version upgrade, to allow for fixing invalid arguments at a later stage;</li> <li>Added task manifest sandbox example (#957);</li> <li>Updated slim-select (v3.4.3) and other dependencies (#980);</li> </ul>"},{"location":"changelog/#1230","title":"1.23.0","text":"<ul> <li>Dropped support for node v18 (#930).</li> <li>Added support for guest user (#913).</li> <li>Run some GitHub Actions when targeting <code>ihb-develop</code> branch (#922).</li> <li>Remove support for <code>Task.source</code> (#931).</li> <li>Remove open button from <code>sharedProjectInfoModal</code> (#927).</li> <li>Prevent Guest selection when Superuser is checked and vice versa (#932).</li> <li>Added the option to customize the login invite, for example to add a disclaimer (#934).</li> <li>Fixed typo in UI (#934).</li> <li>Fixed issue to get correct URL for s3 zarr paths (#935).</li> <li>Replace <code>npm install</code> with <code>npm ci</code> in GitHub Actions (#939).</li> <li>Supported richer workflow/workflowtask metadata (#938).</li> <li>Removed retrieval of legacy tasks status (#944).</li> <li>Pre-selected dataset in workflow jobs list (#944).</li> <li>Displayed task aliases also in \"Run workflow\" modal (#944).</li> </ul>"},{"location":"changelog/#1222","title":"1.22.2","text":"<ul> <li>Fixed issue with nested <code>allOf</code> elements in JSON schema (#908).</li> <li>Fixed glitch with non-atomic user registration (#909);</li> </ul>"},{"location":"changelog/#1221","title":"1.22.1","text":"<ul> <li>Added user column to job lists (#903).</li> <li>Added switch to enable/disable a resource (#903).</li> <li>Added option for re-ordering <code>project_dirs</code> in edit-users page (#903).</li> <li>Allowed users to be added to groups during creation (#903).</li> <li>Added resource filter on admin jobs page (#903).</li> </ul>"},{"location":"changelog/#1220","title":"1.22.0","text":"<ul> <li>Implemented project sharing (#893).</li> <li>Handled paginated responses in task-group admin pages (#893).</li> <li>Supported multiple project directories (#895).</li> <li>Dropped <code>viewer_paths</code> from groups (#895).</li> <li>Added validation of environment variables at startup (#895).</li> <li>Added Node 24 in CI configuration (#895).</li> <li>Updated dataset creation modal with project directory selector and zarr subfolder input (#899).</li> </ul>"},{"location":"changelog/#1211","title":"1.21.1","text":"<ul> <li>Improved logging of error responses received from fractal-server (#880).</li> <li>Added delete option in task-group activities admin page (#880).</li> <li>Adapted the code to avoid non-converter tasks executing on empty images (#880).</li> </ul>"},{"location":"changelog/#1210","title":"1.21.0","text":"<p>This version is aligned with fractal-server 2.17.10.</p> <ul> <li>Updated usage of <code>fractalctl init-db-data</code> for tests (#858).</li> <li>Added more keywords to match SLURM errors (#843).</li> <li>Fixed bug in sandbox pages (#839);</li> <li>Displayed all kinds of recent task activities in tasks management page. (#835);</li> <li>Managed resources and profiles (#845, #862):<ul> <li>Added new admin pages for resources and profiles;</li> <li>Updated admin user pages to associate users with profiles;</li> <li>Updated admin settings page;</li> <li>Merged \"My Profile\" and \"My settings\" pages;</li> </ul> </li> <li>Merged user settings into user (#862);</li> <li>Adapted to OAuth2 changes (#862);</li> <li>Handled user without profile as not verified users (#862);</li> <li>Added support for oneOf and discriminator (#867);</li> <li>Added resource filter on admin task and task-group pages (#867);</li> <li>Handled <code>FRACTAL_DEFAULT_GROUP_NAME</code> environment variable, to specify if a default group is used (#870);</li> <li>Renamed \"Restart workflow\" to \"Reset workflow\" (#876);</li> <li>Added paginator to admin tasks and jobs pages (#876);</li> </ul>"},{"location":"changelog/#1200","title":"1.20.0","text":"<ul> <li>Added body request normalizer (#825);</li> <li>Fixed JSON schema validation during arguments import (#827);</li> <li>Updated slim-select version to support range selection (#827);</li> <li>Supported pre/post <code>pinned_package_versions</code> in task-collection (#827);</li> <li>Adapted frontend to new task-group deletion endpoint (#833);</li> <li>Displayed executor errors (#833);</li> </ul>"},{"location":"changelog/#1193","title":"1.19.3","text":"<ul> <li>Added \"Open in Feature Explorer\" link and <code>PUBLIC_FRACTAL_FEATURE_EXPLORER_URL</code> environment variable (#820);</li> </ul>"},{"location":"changelog/#1192","title":"1.19.2","text":"<ul> <li>Added first and last task index to job info modal (#818);</li> <li>Displayed hourglass icon on submitted tasks that have not run yet (#818);</li> </ul>"},{"location":"changelog/#1191","title":"1.19.1","text":"<ul> <li>Used separate environment variables (<code>PUBLIC_FRACTAL_VIZARR_VIEWER_URL</code> and <code>PUBLIC_FRACTAL_DATA_URL</code>) to configure fractal-data URL and vizarr viewer URL (#816);</li> </ul>"},{"location":"changelog/#1190","title":"1.19.0","text":"<ul> <li>Implemented Pixi task collection (#812);</li> </ul>"},{"location":"changelog/#1185","title":"1.18.5","text":"<ul> <li>Changed default first task selection logic (#810);</li> </ul>"},{"location":"changelog/#1184","title":"1.18.4","text":"<ul> <li>Added <code>workflowtask_id</code> query parameter to <code>verify-unique-types</code> API call (#809);</li> <li>Fixed form enter in task collection component (#809);</li> </ul>"},{"location":"changelog/#1183","title":"1.18.3","text":"<ul> <li>Dropped semver and used API task-groups ordering (#803);</li> <li>Parsed timestamps in <code>admin/accounting</code> (#803);</li> </ul>"},{"location":"changelog/#1182","title":"1.18.2","text":"<ul> <li>Retrieved image status from <code>__wftask_dataset_image_status__</code> attribute (#801);</li> </ul>"},{"location":"changelog/#1181","title":"1.18.1","text":"<ul> <li>Used new API endpoint to detect task version upgrade (#792);</li> <li>Handled arguments schema changes in workflow task runs (#796);</li> <li>Added Run tab in workflow page (#796);</li> <li>Improved handling of viewer paths errors (#796);</li> <li>Added converter non parallel and converter compound to task creation form (#796);</li> </ul>"},{"location":"changelog/#1180","title":"1.18.0","text":"<ul> <li>Upgrade to Svelte 5 (#789);</li> </ul>"},{"location":"changelog/#1174","title":"1.17.4","text":"<ul> <li>Fixed search box not working in workflow submission modal (#787);</li> <li>Fixed \"Get token\" button not working in Safari (#787);</li> <li>Added a disclaimer to non-processed-images warning (#787);</li> </ul>"},{"location":"changelog/#1173","title":"1.17.3","text":"<ul> <li>Displayed warning when attempting to continue a workflow on unprocessed images (#774);</li> <li>Added \"Get URL\" button for plates on dataset page (#774);</li> <li>Fixed workflow status update issue (#774);</li> </ul>"},{"location":"changelog/#1172","title":"1.17.2","text":"<ul> <li>Added <code>NEWS_INFO_PATH</code> variable to display news in home page (#773);</li> <li>Displayed SLURM accounting also for slurm_ssh backend (#773);</li> </ul>"},{"location":"changelog/#1171","title":"1.17.1","text":"<ul> <li>Fixed \"Continue workflow\" for legacy workflows (#772);</li> </ul>"},{"location":"changelog/#1170","title":"1.17.0","text":"<ul> <li>Workflow task flexibility (#759):<ul> <li>Added image list modal in workflow page;</li> <li>Displayed workflow runs in expansible subsections, with frozen arguments;</li> <li>Supported both new and legacy workflow statuses;</li> <li>Displayed per-image logs in workflow image list;</li> <li>Displayed run logs in workflow page;</li> <li>Exposed type filters in workflow submission modals;</li> <li>Added job-submission warning when there are images with different values for some types;</li> </ul> </li> <li>Dropped support for dataset type/attribute filters and removed environment variable <code>ENABLE_INTERACTIVE_ATTRIBUTE_FILTERS</code> (#759);</li> <li>Added a \"Get URL\" button to image list (#759);</li> <li>Supported converter task types (#759);</li> <li>Made user sorting case insensitive (#759);</li> <li>Moved tasks table links to the info modal (#759);</li> <li>Removed \"Download token\" button from profile page, added \"Get token\" button to main dropdown menu (#759);</li> <li>Added job cancellation received message to the workflow page (#767);</li> </ul>"},{"location":"changelog/#1162","title":"1.16.2","text":"<ul> <li>Fixed task version sorting issue (#733);</li> </ul>"},{"location":"changelog/#1161","title":"1.16.1","text":"<ul> <li>Improved handling of new default values in task version update (#731);</li> </ul>"},{"location":"changelog/#1160","title":"1.16.0","text":"<ul> <li>Used <code>FRACTAL_BACKEND_RUNNER=local</code> instead of <code>local_experimental</code> (#713);</li> <li>Moved job submission healthcheck page to user menu (#713);</li> <li>Fixed bug in task-groups deletion in admin page (#713);</li> <li>Fixed bug in task order modal drag and drop (#713);</li> <li>Added admin accounting page (#713);</li> <li>Implemented user impersonation (#713);</li> <li>Improved error handling in proxy functions and documented the usage of Svelte Kit <code>BODY_SIZE_LIMIT</code> environment variable (#713);</li> </ul>"},{"location":"changelog/#1150","title":"1.15.0","text":"<ul> <li>Added type filters flow modal (#701);</li> <li>Pre-populated the image zarr_url (#703);</li> <li>Added validation for type filters and input types compatibility (#703);</li> <li>Displayed input/output task type in \"Type\" tab on workflow page (#691);</li> <li>Removed dataset filters modal, implemented editing of dataset filters directly inside the image list table (#691);</li> <li>Refactored code to new filters format and sent selected filters in run workflow modal (#686);</li> <li>Displayed list of images that would be processed by the first task of a job (#686);</li> <li>Added environment variable <code>ENABLE_INTERACTIVE_ATTRIBUTE_FILTERS</code>, to enable attribute filters on the \"Run workflow\" modal (#686);</li> <li>Fixed findings based on <code>zizmor 1.0.1</code> audit (#687).</li> </ul>"},{"location":"changelog/#1140","title":"1.14.0","text":"<ul> <li>Removed legacy version support (#684);<ul> <li>Removed the environment variables <code>FRACTAL_API_V1_MODE</code> and <code>TEST_VERSION</code>;</li> </ul> </li> </ul>"},{"location":"changelog/#1131","title":"1.13.1","text":"<ul> <li>Tasks table improvements (#677):<ul> <li>Handled install instructions (#677);</li> <li>Made task name a link pointing to <code>docs_link</code> (#677);</li> <li>Removed <code>input_types</code> column (#677);</li> </ul> </li> <li>Fixed task group activity wrong admin API call (#677);</li> <li>Used new replace-task endpoint for version update (#677);</li> <li>Fixed version update for deactivated tasks (#677);</li> </ul>"},{"location":"changelog/#1130","title":"1.13.0","text":"<ul> <li>Moved <code>jschema</code> and other common components to a dedicated<code>components</code> module (#671);</li> <li>Added <code>tasks-list</code> module to generate the tasks-list static page (#671);</li> </ul>"},{"location":"changelog/#1120","title":"1.12.0","text":"<ul> <li>Used form data in tasks collection endpoint (#669);</li> </ul>"},{"location":"changelog/#1112","title":"1.11.2","text":"<ul> <li>Removed usage of <code>cache_dir</code> field (#667);</li> </ul>"},{"location":"changelog/#1111","title":"1.11.1","text":"<ul> <li>Added tasks search filters (#658);</li> <li>Split standard-user tasks page into \"tasks page\" vs \"tasks management page\" (#658);</li> <li>Added alive endpoint (#658);</li> <li>Added user column and sorted users by email in <code>/v2/admin/task-groups/activities</code> (#658);</li> </ul>"},{"location":"changelog/#1110","title":"1.11.0","text":"<ul> <li>Alignment with fractal-server 2.9.0 (#640, #643, #652, #655):<ul> <li>Updated task collections logic and created task-group activities pages for standard users and administrators (#640);</li> <li>Removed active checkbox from task group edit modal (#640);</li> <li>Added Manage button to deactivate and reactivate task groups (#640);</li> <li>Removed usage of DB_ENGINE and SQLITE_PATH variables (#643);</li> <li>Displayed <code>timestamp_last_used</code> property in task-group info modal (#643);</li> <li>Viewer paths page improvements (#643);</li> <li>Added manage buttons on admin task-groups page (#643);</li> <li>Added last used timestamp filter to task-group admin page (#643);</li> <li>Used new <code>GET /auth/current-user/allowed-viewer-paths/</code> endpoint (#652);</li> <li>Added \"Download token\" button in \"My profile\" page (#652);</li> <li>Implemented removal of users from group (#655);</li> <li>Implemented import of user settings from another user (#655);</li> <li>Used new set-groups endpoint (#655);</li> <li>Sorted task-group activities by timestamp_started (more recent first) (#655);</li> </ul> </li> </ul>"},{"location":"changelog/#1101","title":"1.10.1","text":"<ul> <li>Fixed wrong workflow tasks order after task version update (#637);</li> </ul>"},{"location":"changelog/#1100","title":"1.10.0","text":"<ul> <li>Added project dir setting (#634);</li> <li>Made zarr_dir optional when creating dataset (#634);</li> <li>Updated query parameters of GET /api/v2/task/ (#634);</li> <li>Displayed task collection logs also in install phase (#634);</li> <li>Handled missing banner file error (#634);</li> <li>Used fractal-logos sources for README and docs (#634);</li> <li>Added fractal logo (#626);</li> <li>Removed usage of pip extras when installing fractal-server for testing (#626);</li> <li>Removed usage of verbose query parameter in task collection (#626);</li> </ul>"},{"location":"changelog/#190","title":"1.9.0","text":"<ul> <li>Alignment with fractal-server 2.7 (#583, #601, #605, #612, #616, #620):<ul> <li>Removed owner from v2 tasks (#583);</li> <li>Displayed workflow task warning message (#583);</li> <li>Implemented selection of group in task creation (#583);</li> <li>First implementation of new workflow task modal (#583);</li> <li>Used new group_ids_names field (#583);</li> <li>Renamed source to label in custom python env task creation (#583);</li> <li>Changes to admin tasks page (#583, #601);</li> <li>Changed task list to use task groups (#601);</li> <li>Changes to job submission healthcheck page (#601);</li> <li>Implemented task group modal info, edit and delete (#601);</li> <li>Removed usage of source field (#601);</li> <li>Filtered identical task groups (#605);</li> <li>Removed order field from workflow task modal (#605);</li> <li>Disabled editing of task name (#605);</li> <li>Added user group setting editor form (#612);</li> <li>Supported deletion of groups (#612);</li> <li>Sorted tasks by id (#616);</li> <li>Created healthcheck task as private (#616);</li> <li>Used args_schema=false in GET /api/v2/task-group/ (#616);</li> <li>Ignored empty task groups (#616);</li> <li>Checked pkg_name while computing workflow task update candidates (#616);</li> <li>Added admin task groups page (#620);</li> </ul> </li> <li>Fixed dropdown style (#601);</li> <li>Changed \"new version available\" icon (#583);</li> <li>Login page layout improvements (#605);</li> <li>Fixed issue when editing user after setting the superuser privilege (#612);</li> <li>Used response.data.version when displaying task collections (#616);</li> <li>Implemented reordering of tasks in workflow using drag and drop (#616);</li> <li>Fixed broken unsaved changes modal, for non-JSON-schema-based workflowtask edits (#616);</li> <li>Refactored user editing form using only one save button (#616);</li> <li>Allowed same key for attribute and type in input filters (#620);</li> </ul>"},{"location":"changelog/#180","title":"1.8.0","text":"<ul> <li>Drop Node 16 support (#574);</li> <li>Upgraded dependencies (#574):<ul> <li>svelte: 3.x -&gt; 4.x</li> <li>@sveltejs/kit: 1.x -&gt; 2.x</li> <li>@sveltejs/adapter-node: 1.x -&gt; 2.x</li> <li>@sveltejs/adapter-static: 2.x -&gt; 3.x</li> <li>eslint: 8.x -&gt; 9.x</li> <li>typescript: 4.x -&gt; 5.x</li> <li>vite: 4.x -&gt; 5.x</li> <li>vitest: 0.x -&gt; 1.x</li> <li>@vincjo/datatables: 1.6.0 -&gt; 1.14.10</li> <li>bootstrap: 5.2.3 -&gt; 5.3.3</li> </ul> </li> </ul>"},{"location":"changelog/#172","title":"1.7.2","text":"<ul> <li>Added viewer paths editor in admin area (#571);</li> <li>Added user viewer paths page (#571);</li> </ul>"},{"location":"changelog/#171","title":"1.7.1","text":"<ul> <li>Allowed null values in settings API requests (#570);</li> <li>Hided cache dir from user settings page when using SSH Slurm (#570);</li> <li>Made FRACTAL_RUNNER_BACKEND environment variable mandatory (#570);</li> </ul>"},{"location":"changelog/#170","title":"1.7.0","text":"<ul> <li>Added \"My Settings\" page and updated admin user editor (#564);</li> <li>Fixed duplicated entries in owner dropdown (#562);</li> <li>Added \"View plate\" button on dataset page (#562);</li> <li>Improved stability of end to end tests (#560);</li> </ul>"},{"location":"changelog/#160","title":"1.6.0","text":"<ul> <li>Displayed OAuth2 accounts in user profile page (#557);</li> <li>Supported <code>FRACTAL_API_V1_MODE=include_read_only</code> (#557);</li> <li>Added support for displaying temporary warning banner using the <code>WARNING_BANNER_PATH</code> environment variable (#557);</li> <li>Deprecated support for legacy tasks in V2 workflows (#554);</li> </ul>"},{"location":"changelog/#150","title":"1.5.0","text":"<ul> <li>Implemented functionality for creating and displaying user groups (#551);</li> <li>Displayed an error when job submission failed before starting execution of tasks (#548);</li> </ul>"},{"location":"changelog/#143","title":"1.4.3","text":"<ul> <li>Added settings page to admin area (#544);</li> </ul>"},{"location":"changelog/#142","title":"1.4.2","text":"<ul> <li>Added admin page for job submission healthcheck (#543);</li> </ul>"},{"location":"changelog/#141","title":"1.4.1","text":"<ul> <li>Raised a warning upon import/export of a workflow with a custom task (#542);</li> <li>Experimental feature: added vizarr viewer links to dataset page (#542);</li> <li>Used links instead of the \"Open\" button (#542);</li> <li>Added documentation about systemd service config (#542);</li> <li>Added e2e testing of OAuth2 login (#542);</li> <li>Improved handling of validation errors on forms and documentation about error handling (#542);</li> <li>Added <code>white-space: pre-wrap</code> on all <code>pre</code> tags (#542);</li> </ul>"},{"location":"changelog/#140","title":"1.4.0","text":"<ul> <li>Fixed input filters lost after version update (#535);</li> <li>JSON Schema form: computed default values also for empty object (#535);</li> <li>Supported <code>prefixItems</code> of JSON Schema Draft 2020-12 - <code>pydantic_v2</code> (#535);</li> </ul>"},{"location":"changelog/#132","title":"1.3.2","text":"<ul> <li>Supported <code>pydantic_v2</code> schemas (#532);</li> </ul>"},{"location":"changelog/#131","title":"1.3.1","text":"<ul> <li>Fixed custom key not displayed in JSON Schema form (#529);</li> <li>Added dropdown for Python version in tasks (#526);</li> <li>Improved formatting of errors in standard error alert component (#526);</li> <li>Used <code>postgres-psycopg</code> adapter in CI (#525);</li> <li>Used <code>FRACTAL_BACKEND_RUNNER=local_experimental</code> in CI for v2 tests (#525);</li> </ul>"},{"location":"changelog/#130","title":"1.3.0","text":"<p>Starting from this release the Sandbox pages are not included in fractal-web anymore, instead they are static pages published together with the documentation.</p> <ul> <li>Added Custom Python env task collection (#523);</li> <li>Fixed issue with ajv formats on sandbox (#522);</li> <li>Removed \"Clear\" button from tuples (#521);</li> <li>Added \"Reset\" button on top-level properties having a default value (#521);</li> <li>Added task manifest sandbox (#521);</li> <li>Validated invalid text in numeric inputs (#521);</li> <li>Moved JSON Schema components to a separated component (#518);</li> <li>Moved Sandbox pages to a separated component (#518);</li> </ul>"},{"location":"changelog/#120","title":"1.2.0","text":"<ul> <li>Conditionally included V1 pages (#514);</li> <li>Added task version update sandbox page (#509);</li> <li>JSON Schema form improvements (#509):<ul> <li>supported enums of any type;</li> <li>supported tuples;</li> <li>used grey color for optional properties that are unset;</li> <li>hided default label for fields without title.</li> </ul> </li> <li>Added docs about JSON Schema Sandbox page (#509).</li> <li>Added maintenance banner when fractal-server is down (#504).</li> </ul>"},{"location":"changelog/#110","title":"1.1.0","text":"<p>WARNING: with this release all the environment variables will be read from the environment, when the service is started, not during build time. Remember to load in your environment all the variables that you need when you start the service in production. This will not affect development setup. See https://fractal-analytics-platform.github.io/fractal-web/quickstart/ for instructions.</p> <ul> <li>Updated quickstart documenting the changes related to environment variables (#492).</li> <li>Fixed bug in default dataset selection when job references a deleted dataset (#492).</li> <li>Fixed v1 workflow task version update bug (#492).</li> <li>Added <code>npm pack</code> artifacts to files published by the CI during the release (#492).</li> <li>Fixed v2 admin job download link (#492).</li> <li>Imported all the environment variables dynamically (#492).</li> <li>Added backend logging using Log4js (#492).</li> <li>Improved JSON Schema Sandbox page (#490).</li> </ul>"},{"location":"changelog/#104","title":"1.0.4","text":"<ul> <li>Removed users management section from admin area v1 (#485).</li> <li>Included v1/v2 switcher in admin-area job page (#485).</li> <li>Setup tests to use PostgreSQL instead of SQlite (#484).</li> <li>Implemented tasks admin page (#484).</li> <li>Improved form builder used in workflow tasks without JSON Schema and in Meta properties tab (#481).</li> <li>Used collapsible sections in dataset history modal (#481).</li> </ul>"},{"location":"changelog/#103","title":"1.0.3","text":"<ul> <li>fixed issue in task version update when no arguments fix is needed (#477).</li> </ul>"},{"location":"changelog/#102","title":"1.0.2","text":"<ul> <li>fixed issue in task version update with optional arguments (#475).</li> </ul>"},{"location":"changelog/#101","title":"1.0.1","text":"<ul> <li>used payload containing all fields in meta properties PATCH endpoint (#473).</li> </ul>"},{"location":"changelog/#100","title":"1.0.0","text":"<ul> <li>Supported fractal-server API V2:<ul> <li>added menu switch to support legacy and current API (#434, #457);</li> <li>Dataset V2 CRUD with attribute and type filters (#434);</li> <li>new Dataset page with image list and filters (#434);</li> <li>updated Single Task form to handle parallel and non parallel fields (#434);</li> <li>updated workflow task form to handle parallel and non parallel arguments (#434);</li> <li>handled V2 import and export of workflow task arguments (#434);</li> <li>handled V2 version workflow task version update (#434);</li> <li>added admin \"Tasks V1/V2 compatibility\" page (#450);</li> <li>supported adding V1 task in V2 workflow (#450);</li> <li>removed read only property from V2 datasets (#450);</li> <li>added input filters tab in workflow task page (#452, #457);</li> <li>added searchable dropdowns for image filters (#452);</li> <li>moved editing of dataset inside dataset page (#452);</li> <li>supported editing of single dataset images (#457);</li> <li>used switches to represent boolean flags (#457);</li> <li>implemented continue/restart workflow (#465);</li> <li>set default first task when continuing a workflow (#466);</li> <li>displayed applied filters in workflow execution modal (#466);</li> <li>implemented import and export of datasets (#467);</li> <li>handled selection of default dataset on workflow page (#467);</li> </ul> </li> </ul>"},{"location":"changelog/#0102","title":"0.10.2","text":"<ul> <li>Added search functionality on jobs table filters (#424).</li> </ul>"},{"location":"changelog/#0101","title":"0.10.1","text":"<ul> <li>Fixed bug in workflow task meta properties update (#422).</li> </ul>"},{"location":"changelog/#0100","title":"0.10.0","text":"<p>This release requires fractal-server 1.4.6.</p> <ul> <li>Improved id and timestamp layout on jobs table (#420).</li> <li>Added query parameters to avoid loading unused fields on the following GET endpoints (#420):<ul> <li><code>/api/v1/job/</code>, <code>/api/v1/{project.id}/job/</code>, <code>/admin/job/</code> (<code>log</code> param)</li> <li><code>/api/v1/task/</code> (<code>args_schema</code> param)</li> <li><code>/api/v1/dataset/</code>, <code>/api/v1/project/{project.id}/dataset/</code> (<code>history</code> param)</li> </ul> </li> <li>Added <code>show_tmp_logs=true</code> query parameter to display log of running jobs (#420).</li> </ul>"},{"location":"changelog/#092","title":"0.9.2","text":"<ul> <li>Supported JSON Schema <code>allOf</code> feature in task arguments form (#417).</li> </ul>"},{"location":"changelog/#091","title":"0.9.1","text":"<ul> <li>Improved visualization of details on job logs modal (#415).</li> <li>Added job id filter on admin jobs page (#415).</li> <li>Added spinner on workflow task modal when tasks list is loading (#410).</li> <li>Implemented import and export of workflow task arguments (#410).</li> <li>Improved sorting of users in dropdown of the admin jobs page (#402).</li> <li>Fixed bug in retrieval of job log from the admin jobs page (#402).</li> <li>Highlighted relevant part of the error message in workflow job log modal (#402).</li> <li>Made the error message directly accessible from the new workflow page (#402).</li> </ul>"},{"location":"changelog/#090","title":"0.9.0","text":"<p>This release requires fractal-server 1.4.3.</p> <ul> <li>Removed <code>running</code> job status (#401).</li> <li>Aligned timestamp definitions with fractal-server 1.4.3 (#401).</li> <li>Sorted projects by descending creation timestamp (#401).</li> <li>Removed coverage setup from Playwright tests and CI (#399).</li> </ul>"},{"location":"changelog/#082","title":"0.8.2","text":"<ul> <li>Improvements on worflow task form (#393):<ul> <li>supported JSON Schema <code>enum</code> type;</li> <li>supported JSON Schema <code>minimum</code>, <code>maximum</code>, <code>exclusiveMinimum</code> and <code>exclusiveMaximum</code> for numeric types;</li> <li>supported JSON Schema <code>minItems</code> and <code>maxItems</code> for array type;</li> <li>supported reordering of array fields;</li> <li>set bold font on nested required properties;</li> <li>improved field validation error messages.</li> </ul> </li> <li>Add trailing slash to OAuth-callback url (#395).</li> </ul>"},{"location":"changelog/#081","title":"0.8.1","text":"<p>Note: with this release, <code>PUBLIC_FRACTAL_ADMIN_SUPPORT_EMAIL</code> becomes a required environment variable, and <code>npm run build</code> fails if it is missing. If you do not need a support email, just include a <code>PUBLIC_FRACTAL_ADMIN_SUPPORT_EMAIL=</code> line in your env file.</p> <ul> <li>Made <code>PUBLIC_FRACTAL_ADMIN_SUPPORT_EMAIL</code> static (#391).</li> <li>Added SLURM-account selection for user editing and for job execution (#391).</li> <li>Improved buttons feedback for slow API calls (#389).</li> </ul>"},{"location":"changelog/#080","title":"0.8.0","text":"<p>This release requires fractal-server 1.4.2.</p> <ul> <li>Users registered by the admin are automatically verified (#386).</li> <li>A warning message is displayed to unverified users (#386).</li> <li>Made page headers more homogeneous (#386).</li> <li>Replaced some icons with more suitable ones (#386).</li> <li>Added search boxes on datasets, workflows and workflow tasks selection (#386).</li> <li>Moved \"Create new workflow\" to a modal (#386).</li> <li>Added search project field on projects list page (#379).</li> <li>Used modal to create new project (#379).</li> <li>Sorted users in admin-area page (#379).</li> <li>Exposed stop-job and download-logs in admin-area jobs page (#379).</li> <li>Displayed number of rows in admin jobs page (#379).</li> <li>Fixed semver circular dependency issue (#379).</li> <li>Fixed issue with version sorting (#379).</li> <li>Sorted datasets by name (#379).</li> <li>Fixed accessibility issue (#379).</li> <li>Improved performance reducing the number of API calls on project, workflow and dataset pages (#379).</li> </ul>"},{"location":"changelog/#072","title":"0.7.2","text":"<p>Note: with this release, <code>PUBLIC_OAUTH_CLIENT_NAME</code> becomes a required environment variable, and <code>npm run build</code> fails if it is missing. If you do not need OAuth2 authentication, just include a <code>PUBLIC_OAUTH_CLIENT_NAME=</code> line in your env file.</p> <ul> <li>Made <code>PUBLIC_OAUTH_CLIENT_NAME</code> static (#376).</li> <li>Added help messages to user registration (#376).</li> <li>Made <code>AUTH_COOKIE_DOMAIN</code> optional (#376).</li> <li>Fixed hardcoded OAuth2 variable (#376).</li> </ul>"},{"location":"changelog/#071","title":"0.7.1","text":"<ul> <li>Auto-refresh of tasks table when a tasks collection completes successfully (#364).</li> <li>Auto-refresh of tasks collection status (#364).</li> <li>Made tasks list more compact by hiding the older versions (#364).</li> <li>Added the following fields on single task creation:<ul> <li>args schema file upload (#364).</li> <li>meta file upload (#364).</li> <li>docs info and docs link (#364).</li> </ul> </li> <li>Added editing of pinned package versions on tasks collection (#364).</li> <li>Supported editing of <code>cache_dir</code> from user profile page (#365).</li> <li>Added experimental workflow page with job monitoring (#363).</li> </ul>"},{"location":"changelog/#070","title":"0.7.0","text":"<p>This release requires fractal-server 1.4.0.</p> <ul> <li>Added admin jobs page (#352).</li> <li>Fixed expiration token issue for /admin and /auth endpoints (#352).</li> <li>Used new endpoints for retrieving current user and list of users (#350).</li> <li>Added user profile page (#336).</li> <li>Added admin area with users management (#336).</li> <li>Added Jobs button in home page (#346).</li> <li>Improved jobs table layout for small screens (#346).</li> <li>Fixed jobs status badge color bug (#346).</li> <li>Aligned with fractal-server 1.4.0 API, including trailing slash for endpoints' paths (#328).</li> <li>Added spinner during page loading (#328).</li> <li>Job pages:<ul> <li>Created per-user and per-workflow jobs pages (#328).</li> <li>Removed per-project jobs pages (#328).</li> <li>Added automatic background update job pages (#328).</li> </ul> </li> <li>Improved handling of session expiration (#333).</li> <li>Fixed logout bug (#327).</li> <li>Implemented OAuth2 login (#333).</li> <li>Added more playwright tests (#332).</li> </ul>"},{"location":"changelog/#063","title":"0.6.3","text":"<ul> <li>Implemented task-version update (#325).</li> </ul>"},{"location":"changelog/#062","title":"0.6.2","text":"<ul> <li>Fixed peformance issue with argument-description popovers (#324).</li> <li>Added end-to-end tests and coverage configuration (#320).</li> </ul>"},{"location":"changelog/#061","title":"0.6.1","text":"<p>This release works best with fractal-server &gt;=1.3.12 (since it makes use of the <code>dataset.history</code> property), but previous fractal-server versions are still supported.</p> <ul> <li>Added dataset history modal (#316).</li> <li>Fixed bug with save/discard changes in workflow task (#315).</li> <li>Fixed first-run redirects issue (#315).</li> </ul>"},{"location":"changelog/#060","title":"0.6.0","text":"<ul> <li>Added fractal-web version to the footer (#312).</li> <li>Added new modal for create/update dataset feature (#310).</li> <li>Standardized modal management to fix some bugs (#306).</li> <li>Added proxy endpoints and refactored error propagation (#288).</li> <li>Remove use of deployment-type <code>fractal-server</code> variable (#298).</li> <li>Add GitHub action to create GitHub releases (#305).</li> <li>Add a BSD3 license (#300).</li> </ul>"},{"location":"changelog/#056","title":"0.5.6","text":"<ul> <li>Improve displaying of <code>Dataset.meta</code> properties (#281).</li> <li>Remove obsolete file <code>src/routes/api/alive/+server.js</code> (#283).</li> </ul>"},{"location":"changelog/#055","title":"0.5.5","text":"<ul> <li>Fix bug in <code>JSchema.svelte</code> (#279).</li> </ul>"},{"location":"changelog/#054","title":"0.5.4","text":"<ul> <li>Always propagate cookie for API calls to <code>FRACTAL_SERVER_HOST</code>, even for different domains (#275).</li> </ul>"},{"location":"changelog/#053","title":"0.5.3","text":"<ul> <li>Add confirmation dialog for delete-task operation (#272).</li> <li>Enable WorkflowTask Info tab, and render <code>docs_info</code> from markdown (#271).</li> <li>Update import-workflow feature (#269).</li> <li>Revamp home page and user-related layout (#259).</li> <li>Review logout action (#259).</li> <li>Implement editing and deletion of tasks (#207, #268). </li> <li>Implement A-to-B workflow execution (#254).</li> <li>Fix WorkflowTask <code>meta</code> update (#261).</li> <li>Improve enable/disable button state, for project/dataset/workflow/resource creation (#257).</li> </ul>"},{"location":"changelog/#052","title":"0.5.2","text":"<ul> <li>Improve tasks handling within the client (#233).</li> <li>Prevent accidental loss of user-provided WorkflowTask arguments (#234).</li> </ul>"},{"location":"changelog/#051","title":"0.5.1","text":"<p>First release included in this CHANGELOG.</p>"},{"location":"environment-variables/","title":"Environment variables","text":"<p>The following environment variables can be used to configure fractal-web. </p> <p>Only when using <code>npm run dev</code> or <code>npm run preview</code> these variables are automatically read from <code>.env.development</code> and <code>.env</code> files. In production they must be set in the shell that starts the node process.</p> <ul> <li><code>FRACTAL_SERVER_HOST</code>: represents the URL of the fractal-server application (e.g. http://localhost:8000, or http://subdomain.example.org:8000); this variable is required;</li> <li><code>AUTH_COOKIE_NAME</code>: the name of the cookie used to store the user session; the default value is <code>fastapiusersauth</code>;</li> <li><code>AUTH_COOKIE_DOMAIN</code>: specifies which server can receive the cookie (note: this must not include the <code>http</code> or <code>https</code> URL scheme); remember to set it in production;</li> <li><code>AUTH_COOKIE_PATH</code>: the URL path where the cookie will be available; the default value is <code>/</code>;</li> <li><code>AUTH_COOKIE_SECURE</code>: sends the cookie only if the server is using HTTPS; the default value is <code>true</code>, can be set to <code>false</code> during development;</li> <li><code>AUTH_COOKIE_SAME_SITE</code>: set the SameSite attribute to the cookie; the default value is <code>lax</code>;</li> <li><code>PUBLIC_FRACTAL_ADMIN_SUPPORT_EMAIL</code>: the e-mail address displayed in the home page which can be used to send support requests; if the value is not set nothing is shown;</li> <li><code>PUBLIC_UPDATE_JOBS_INTERVAL</code>: the delay in milliseconds which occurs between two background requests that check for job status updates; the default value is <code>3000</code>;</li> <li><code>PUBLIC_OAUTH_CLIENT_NAME</code>: if set, the application enables the external account login via OAuth2; the name is used to create the authorization call sent to fractal-server (see configuration page);</li> <li><code>LOG_FILE</code>: the path of the file where logs will be written; by default is unset and no file will be created;</li> <li><code>LOG_LEVEL_FILE</code>: the log level of logs that will be written to the file; the default value is <code>info</code>;</li> <li><code>LOG_LEVEL_CONSOLE</code>: the log level of logs that will be written to the console; the default value is <code>warn</code>;</li> <li><code>FRACTAL_RUNNER_BACKEND</code>: specifies which runner backend is used; supported values are: <code>local</code>, <code>slurm</code>, <code>slurm_ssh</code>; setting this variable is mandatory;</li> <li><code>PUBLIC_FRACTAL_DATA_URL</code>: URL to fractal-data service (e.g. http://localhost:3000/data for testing);</li> <li><code>PUBLIC_FRACTAL_VIZARR_VIEWER_URL</code>: URL to vizarr viewer (e.g. http://localhost:3000/data/vizarr for testing);</li> <li><code>PUBLIC_FRACTAL_FEATURE_EXPLORER_URL</code>: URL to Fractal Feature Explorer (e.g. http://localhost:8501 for testing);</li> <li><code>WARNING_BANNER_PATH</code>: specifies the path to a text file containing the warning banner message displayed on the site; the banner is used to inform users about important issues, such as external resources downtime or maintenance alerts; if the variable is empty or unset no banner is displayed;</li> <li><code>LOGIN_INVITE_PATH</code>: specifies the path to a text file containing the message to display when user wants to log on. This can be for example a disclaimer or special instructions. Text can contain html tags for formatting. If the variable is empty default message is displayed;</li> <li><code>NEWS_INFO_PATH</code>: specifies the path to a Markdown file containing the news section of the home page; the title of the section is automatically added; if the variable is empty or unset the news section is not displayed;</li> <li><code>FRACTAL_DEFAULT_GROUP_NAME</code>: specifies if a default group exists; allowed values are <code>All</code> or empty string (no default group).</li> <li><code>PUBLIC_GUEST_USERNAME</code>: username for guest user;</li> <li><code>PUBLIC_GUEST_PASSWORD</code>: password for guest user;</li> </ul> <p>When running directly using <code>node</code> command these extra variables can also be configured:</p> <ul> <li><code>PORT</code>: specifies the port where Svelte server will run; the default value is 5173;</li> <li><code>ORIGIN</code> the URL where the app will be served (e.g. http://localhost:5173, or https://subdomain.example.org);</li> <li><code>BODY_SIZE_LIMIT</code>: the maximum request body size accepted in bytes; see official SvelteKit documentation.</li> </ul>"},{"location":"environment-variables/#common-issues-related-to-environment-variables","title":"Common issues related to environment variables","text":"<p>The <code>node</code> command relies on some extra environment variables, and especially on <code>ORIGIN</code>:</p> <p>HTTP doesn't give SvelteKit a reliable way to know the URL that is currently being requested. The simplest way to tell SvelteKit where the app is being served is to set the <code>ORIGIN</code> environment variable  (see SvelteKit node servers documentation). A wrong origin value will result in the error message \"Cross-site POST form submissions are forbidden\".</p> <p>Unexpected behaviors can be related to wrong values of the <code>AUTH_COOKIE_DOMAIN</code> variable:</p> <p>A typical gotcha: if there is a mismatch between the cookie domain and the URL you are using (e.g. one points to localhost and the other one to 127.0.0.1), then the cookie won't be set and this will fail silently, therefore likely triggering other unexpected behaviors. If you leave the <code>AUTH_COOKIE_DOMAIN</code> empty, the cookie domain will be inferred from the HTTP call. This is useful to avoid domain mismatch issues during testing and development, but in production is suggested to set it as the name of the domain where the fractal-web server is running.</p>"},{"location":"examples/","title":"Examples","text":"<p>in progress</p> <p>See examples in https://github.com/fractal-analytics-platform/fractal-web/tree/main/examples, with configurations for:</p> <ul> <li>fractal-server</li> <li>fractal-web</li> <li>Apache proxy</li> </ul>"},{"location":"fractal_server/","title":"Basic guide for fractal-server startup","text":"<p>The <code>lib/fractal-server</code> folder describes the basic steps to install and run a local <code>fractal-server</code> instance, that can be then accessed through <code>fractal-web</code>.</p> <p>Briefly, one should: * Install fractal-server (<code>pip install fractal-server</code>); * Set up the database (<code>fractalctl set-db</code>); * Startup an instance (<code>fractalctl start</code>).</p> <p>Notes: 1. There must exist a <code>.fractal_server.env</code> file (see example in    <code>../lib/fractal-server/</code>), with some configuration variables. 2. It is necessary that the fractal-server instance is reachable from the    client by network connection (this is typically trivial, if fractal-server    is run locally e.g. at http://localhost:8000). This address also needs to match    the one in the <code>fractal-web</code> configuration file (either <code>.env</code> or    <code>.env.development</code>, depending on how you are running <code>fractal-web</code>). 3. It is useful to set the fractal-server environment variable    <code>JWT_EXPIRE_SECONDS</code> to a relevant value for the user to persist its session    on the client (e.g. <code>JWT_EXPIRE_SECONDS=84600</code>). 4. The configuration env file also defines some default credentials for an    admin user, that can be used for testing.</p>"},{"location":"oauth2/","title":"Integration with OAuth2 providers","text":"<p>Fractal supports OAuth2 login using GitHub, Google or custom providers.</p> <p>First, configure the server as described in OAuth2 documentation of fractal-server.</p> <p>Fractal-web callback has to be defined using the following path: <code>/auth/login/oauth2</code>.</p> <p>Then, enable the desired provider on fractal-web using the <code>PUBLIC_OAUTH_CLIENT_NAME</code> environment variable, for example:</p> <pre><code>PUBLIC_OAUTH_CLIENT_NAME=github\n</code></pre> <p>This variable has to match the client name defined in fractal-server configuration.</p>"},{"location":"oauth2/#full-details-for-local-example","title":"Full details for local example","text":"<ol> <li>Register an OAuth2 app on GitHub with<ul> <li>Homepage URL: http://127.0.0.1:5173</li> <li>Authorization callback URL: http://127.0.0.1:5173/auth/login/oauth2/</li> </ul> </li> <li>Set up the following env variables for fractal-server: <pre><code>OAUTH_CLIENT_NAME=github\nOAUTH_CLIENT_ID=...\nOAUTH_CLIENT_SECRET=...\nOAUTH_REDIRECT_URL=http://127.0.0.1:5173/auth/login/oauth2/\n# [all other variables]\n</code></pre></li> <li>Set up the following env variables for fractal-web: <pre><code>FRACTAL_SERVER_HOST=http://127.0.0.1:8000\nAUTH_COOKIE_DOMAIN=127.0.0.1\nPUBLIC_OAUTH_CLIENT_NAME=github\n# [all other variables]\n</code></pre></li> </ol>"},{"location":"quickstart/","title":"Quickstart instructions","text":"<p>This page describes how to install fractal-web from release packages. If you need to install it from the git repository see the development setup page.</p>"},{"location":"quickstart/#install-node","title":"Install node","text":"<p>Versions 18 or 20 of Node.js are recommended (check your version with <code>node -v</code>). Version 16 is known to work, but not recommended.</p> <p>If these versions are not available via your favorite package installer, you can install them from this link for your specific platform. Another option is to use nvm, e.g. via <pre><code>nvm install 18\nnvm alias default 18\n</code></pre></p>"},{"location":"quickstart/#install-fractal-web-from-release-packages","title":"Install fractal-web from release packages","text":"<p>Starting from version 1.1.0, fractal-web releases provide tar.gz files containing the built files for each supported node version. You can install these packages with the following command:</p> <pre><code>FRACTAL_WEB_VERSION=1.1.0 &amp;&amp; NODE_MAJOR_VERSION=20 &amp;&amp; wget -qO- \"https://github.com/fractal-analytics-platform/fractal-web/releases/download/v${FRACTAL_WEB_VERSION}/node-${NODE_MAJOR_VERSION}-fractal-web-v${FRACTAL_WEB_VERSION}.tar.gz\" | tar -xz\n</code></pre> <p>Note: this will unpack in the current working directory the file <code>package.json</code> and the folders <code>build</code> and <code>node_modules</code>.</p> <p>To start the application installed in this way see the section Run fractal-web from the build folder below.</p>"},{"location":"quickstart/#set-environment-variables","title":"Set environment variables","text":"<p>To properly run fractal-web you have to configure some environment variables. The environment variables page contains the complete list of supported environment variables and their default values. It also includes some troubleshooting infomation about errors related to environment variables misconfiguration.</p> <p>If you want to run the application executing <code>node</code> in the <code>build</code> folder you have to export the environment variables in your shell. The following section provides an example on how to do that with a script.</p>"},{"location":"quickstart/#run-fractal-web-from-the-build-folder","title":"Run fractal-web from the build folder","text":"<p>You can create a script with the following content to run fractal-web installed from a release package:</p> <pre><code>#!/bin/sh\n\nexport FRACTAL_SERVER_HOST=http://localhost:8000\nexport PUBLIC_FRACTAL_ADMIN_SUPPORT_EMAIL=help@localhost\nexport PUBLIC_OAUTH_CLIENT_NAME=\n# remember to set this in production (e.g. subdomain.example.org)\nexport AUTH_COOKIE_DOMAIN=\n\nexport ORIGIN=http://localhost:5173\nexport PORT=5173\nexport BODY_SIZE_LIMIT=5000000\n\nexport LOG_FILE=fractal-web.log\n# default values for logging levels (uncomment if needed)\n# export LOG_LEVEL_FILE=info\n# export LOG_LEVEL_CONSOLE=warn\n\nexport FRACTAL_RUNNER_BACKEND=local\n\n#export PUBLIC_FRACTAL_DATA_URL=\n#export PUBLIC_FRACTAL_VIZARR_VIEWER_URL=\n#export PUBLIC_FRACTAL_FEATURE_EXPLORER_URL=\n#export WARNING_BANNER_PATH=\n#export NEWS_INFO_PATH=\n#export LOGIN_INVITE_PATH=\n\n# default values are usually fine for the following variables; remove comments if needed\n#export AUTH_COOKIE_NAME=fastapiusersauth\n#export AUTH_COOKIE_PATH=/\n#export AUTH_COOKIE_SAME_SITE=lax\n#export PUBLIC_UPDATE_JOBS_INTERVAL=3000\n#export FRACTAL_DEFAULT_GROUP_NAME=\n\nnode build/\n</code></pre> <p>Note: starting from Node 20 you can also load the environment variables from a file using the <code>--env-file</code> flag:</p> <pre><code>node --env-file=.env build\n</code></pre>"},{"location":"quickstart/#systemd-service","title":"Systemd service","text":"<p>To run fractal-web as a Systemd service create the file <code>/etc/systemd/system/fractal-web.service</code> with the following content:</p> <pre><code>[Unit]\nDescription=Fractal Web\nAfter=syslog.target\n\n[Service]\nUser=fractal\nEnvironmentFile=/path/to/fractal-web/.env\nExecStart=/path/to/node /path/to/fractal-web/build\nRestart=on-failure\nRestartSec=5s\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Enable the service:</p> <pre><code>sudo systemctl enable fractal-web\n</code></pre> <p>Start the service:</p> <pre><code>sudo systemctl start fractal-web\n</code></pre> <p>Check the service logs:</p> <pre><code>sudo journalctl -u fractal-web\n</code></pre>"},{"location":"sandbox-pages/","title":"Sandbox pages","text":"<p>When developing tasks it can be useful to have a quick way to test how a given JSON schema will appear in the workflow task arguments form.</p> <p>The following sandbox pages are available:</p> <ul> <li>JSON Schema Sandbox page</li> <li>Task Manifest Sandbox page</li> </ul> <p>Both these pages provide a textarea for the JSON schemas. Notice that you can't paste the whole task manifest: you need to pick one of the <code>args_schema</code> values.</p> <p>To locally preview the sandbox pages enter the <code>sandbox</code> directory and run:</p> <pre><code>npm install\nnpm run dev\n</code></pre>"},{"location":"version-compatibility/","title":"Version Compatibility","text":"<p>The following table shows which <code>fractal-server</code> versions are compatible with which <code>fractal-web</code> versions.</p> fractal-web fractal-server 1.23.0 2.19.0 1.22.2 2.18.2 1.22.1 2.18.2 1.22.0 2.18.1 1.21.0 2.17.0 1.20.1 2.16.0 1.20.0 2.16.0 1.19.3 2.15.3 1.19.2 2.15.3 1.19.1 2.15.0 1.19.0 2.15.0 1.18.5 2.14.15 1.18.4 2.14.15 1.18.3 2.14.13 1.18.2 2.14.12 1.18.1 2.14.8 1.18.0 2.14.1 1.17.4 2.14.1 1.17.3 2.14.1 1.17.2 2.14.0 1.17.1 2.14.0 1.17.0 2.14.0 1.16.2 2.13.1 1.16.1 2.13.1 1.16.0 2.13.1 1.15.0 2.11.0 1.14.0 2.10.1 1.13.1 2.10.1 1.13.0 2.10.0 1.12.0 2.10.0 1.11.2 2.9.2 1.11.1 2.9.0 1.11.0 2.9.0 1.10.1 2.8.0 1.10.0 2.8.0 1.9.0 2.7.0 1.8.0 2.6.3 1.7.2 2.6.3 1.7.1 2.6.2 1.7.0 2.6.0 1.6.0 2.5.0 1.5.0 2.4.0 1.4.3 2.3.0 1.4.2 2.3.0 1.4.1 2.3.0 1.4.0 2.3.0 1.3.2 2.3.0 1.3.1 2.3.0 1.3.0 2.3.0 1.2.0 2.0.6 1.1.0 2.0.5 1.0.4 2.0.5 1.0.3 2.0.0 1.0.2 2.0.0 1.0.1 2.0.0 1.0.0 2.0.0 0.10.2 1.4.6 0.10.1 1.4.6 0.10.0 1.4.6 0.9.2 1.4.3 0.9.1 1.4.3 0.9.0 1.4.3 0.8.2 1.4.2 0.8.1 1.4.2 0.8.0 1.4.2"},{"location":"development/","title":"Development","text":"<p>Here are some useful details for <code>fractal-web</code> developments:</p> <ul> <li>Development setup</li> <li>Code-base structure</li> <li>Error handling</li> <li>JSON Schema form module</li> <li>Testing</li> <li>Documentation</li> <li>Precommit</li> <li>Release</li> </ul>"},{"location":"development/docs/","title":"Documentation","text":"<p>Here are the instructions to serve the documentation on localhost:8001:</p> <pre><code>python -m venv venv\nsource venv/bin/activate\npython -m pip install -r docs/requirements.txt\nmkdocs serve --dev-addr localhost:8001\n</code></pre> <p>The documentation includes links to the sandbox pages. These pages are built separately and added to the site folder by the CI before publishing the documentation, so these links will not work using the mkdocs preview command displayed above. If you want to preview the sandbox pages run <code>npm run dev</code> inside the sandbox folder.</p>"},{"location":"development/error-handling/","title":"Error handling","text":"<p>This page describes which coding patterns are used by fractal-web to handle various error cases.</p>"},{"location":"development/error-handling/#fractal-server-errors-structure","title":"Fractal-server errors structure","text":"<p>Fractal-server error responses payloads are usually JSON structures having the error under a <code>detail</code> key. This is not true for the 500 Internal Server Error, which doesn't provide a JSON payload.</p> <p>Generic fractal-server errors contain the error message string directly as <code>detail</code> value or as an array of values:</p> <pre><code>{ \"detail\": \"this is the error message\" }\n</code></pre> <pre><code>{ \"detail\": [\"this is also an error\"] }\n</code></pre> <p>Validation errors associated with a specific request field are represented using a <code>loc</code> array that describes the position of the invalid field in the request payload:</p> <pre><code>{\n\"detail\": [\n{\n\"loc\": [\n\"body\",\n\"zarr_url\"\n],\n\"msg\": \"URLs must begin with '/' or 's3'.\",\n\"type\": \"value_error\"\n}\n]\n}\n</code></pre> <p>Some validation errors may not be associated with a specific field and in that case their <code>loc</code> array will reference a <code>__root__</code> element:</p> <pre><code>{\n\"detail\": [\n{\n\"loc\": [\n\"body\",\n\"__root__\"\n],\n\"msg\": \"error message\",\n\"type\": \"value_error\"\n}\n]\n}\n</code></pre> <p>The goal of fractal-web is to extract the error message and display it inside an alert component or directly near the invalid form field, when possible. If an unexpected JSON structure is received, fractal-web will display the error JSON payload as it is, but that should happen rarely, except for the JSON Schema form, whose errors may result in some complex payloads.</p>"},{"location":"development/error-handling/#error-responses-in-svelte-backend-ssr","title":"Error responses in Svelte backend (SSR)","text":"<p>Files in <code>src/lib/server/api</code> provide API calls to fractal-server to be used from Svelte backend. These calls are usually required to be successful in order to properly display the page, since they retrieve the main resources of the page. A failure at this level is usually a 404 error (e.g. attempting to open a project with a non existent id) or something really severe (500 errors). For this reason the API calls errors happening on Svelte backend should usually be directly propagated, in order to display the error code inside the page.</p> <p>The utility function <code>responseError()</code> (in <code>error.js</code>) can be used to propagate the error in these cases. It will throw an exception if an error response is detected, automatically extracting the <code>detail</code>.</p> <p>It is suggested to handle the unsuccessful response first, in order to return the payload at the end of the function.</p> <pre><code>if (!response.ok) {\nawait responseError(response);\n}\nreturn await response.json();\n</code></pre> <p>In this way it is easier to define properly the type of the response using JSDoc annotation.</p>"},{"location":"development/error-handling/#error-responses-in-svelte-frontend","title":"Error responses in Svelte frontend","text":""},{"location":"development/error-handling/#the-alerterror-class","title":"The AlertError class","text":"<p>The <code>AlertError</code> class represents errors handled by fractal-web that has to be displayed somewhere. It has a constructor that receives an object or string representing the error and an optional status code (if the error was originated from an unsuccessful API call).</p> <p>It can be used to istantiate a new error message; this is mostly used when we need to propagate an error from a component to another, that will catch the error:</p> <pre><code>throw new AlertError('Invalid JSON schema');\n</code></pre> <p>Most of the time it is used to handle an unsuccessful API response; the status code is used to check if it is a validation error (status is equals to 422) and it automatically extracts the message from the detail:</p> <pre><code>throw await getAlertErrorFromResponse(response);\n</code></pre>"},{"location":"development/error-handling/#the-standard-error-alert","title":"The standard error alert","text":"<p>It is possible to use the <code>displayStandardErrorAlert()</code> function to display a generic error inside an Bootstrap alert component. The function returns a reference to a <code>StandardErrorAlert</code> component, that can be used to hide the error invoking its <code>hide()</code> function.</p> <p>Inside the page we have to add a div for the alert component, with a defined id:</p> <pre><code>&lt;div id=\"errorAlert-projectInfoModal\" /&gt;\n</code></pre> <p>Then we have to define a variable for the alert component:</p> <pre><code>/** @type {import('$lib/components/common/StandardErrorAlert.svelte').default|undefined} */\nlet errorAlert = undefined;\n</code></pre> <p>Finally, we invoke the function to display the error:</p> <pre><code>errorAlert = displayStandardErrorAlert(\nnew AlertError(result, response.status),\n'errorAlert-projectInfoModal'\n);\n</code></pre> <p>If we need to hide the error (for example before clicking a submit button again), we can invoke the <code>hide()</code> function.</p> <pre><code>errorAlert?.hide();\n</code></pre> <p>Notice that we are using the optional chaining operator (<code>?.</code>), since the variable might be undefined if no error happened previously.</p>"},{"location":"development/error-handling/#form-validation-errors","title":"Form validation errors","text":"<p>A form usually needs an error alert component to display generic errors and a mechanism to display errors associated with specific form fields. This logic has been incapsulated in the <code>FormErrorHandler</code> class.</p> <p>The constructor accepts as first argument the id of the div that will contain the generic error message and as second argument an array containing all the fields that correspond with some input fields in the form.</p> <pre><code>const formErrorHandler = new FormErrorHandler('taskCollectionError', [\n'package',\n'package_version',\n'package_extras',\n'python_version'\n]);\n</code></pre> <p>Once created, it is possible to retrieve the <code>validationErrors</code> object from the form error handler:</p> <pre><code>const validationErrors = formErrorHandler.getValidationErrorStore();\n</code></pre> <p>This is a Svelte store referencing a map of errors, so it has to be accessed prepending the <code>$</code> symbol: <code>$validationErrors</code>, as shown in the example above.</p> <p>The Bootstrap validation classes are used inside the form: <code>has-validation</code> on parent, <code>is-invalid</code> on the invalid field and <code>invalid-feedback</code> for the message.</p> <pre><code>&lt;div class=\"input-group has-validation\"&gt;\n  &lt;div class=\"input-group-text\"&gt;\n    &lt;label class=\"font-monospace\" for=\"package\"&gt;Package&lt;/label&gt;\n  &lt;/div&gt;\n  &lt;input\n    name=\"package\"\n    id=\"package\"\n    type=\"text\"\n    class=\"form-control\"\n    required\n    class:is-invalid={$validationErrors['package']}\n    bind:value={python_package}\n  /&gt;\n  &lt;span class=\"invalid-feedback\"&gt;{$validationErrors['package']}&lt;/span&gt;\n&lt;/div&gt;\n</code></pre> <p>The <code>handleErrorResponse()</code> function is used to populate the fields from an error response:</p> <pre><code>if (!response.ok) {\nawait formErrorHandler.handleErrorResponse(response);\n}\n</code></pre> <p>The class also provides a <code>clearErrors()</code> function and some functions to manually add or remove errors (<code>addValidationError()</code>, <code>removeValidationError()</code>, <code>setGenericError()</code>); these are useful to handle some validation directly on the frontend (e.g. required fields), without performing any API calls.</p>"},{"location":"development/jschema/","title":"JSON Schema form module","text":"<p>The <code>components</code> folder on this repository contains a Svelte project that provides the JSON Schema form component (<code>JSchema.svelte</code>) and its related functions and classes. The file <code>index.js</code> contains the list of components and functions that are exported for public usage, so that they can be included using <code>from 'fractal-components'</code> from the main project.</p> <p>The main project defines <code>fractal-components</code> in <code>vite.config.js</code>, as an alias pointing to <code>components/src/lib/index.js</code>. In this way the components module is automatically built when the main project is built and the Hot Module Reload feature still works.</p> <p>Moreover, the path to components module has been added as <code>server.fs.allow</code> Vite config option, to prevent the following error while serving the files using <code>npm run dev</code>:</p> <pre><code>The request url \"/path/to/fractal-web/components/src/lib/index.js\" is outside of Vite serving allow list.\n</code></pre> <p>Important: When importing js files inside the <code>components</code> module it is necessary to use a relative path. The editor might autocomplete the imports using the <code>$lib</code> prefix, but that will not work when the module is included in the main application, since it redefines the <code>$lib</code> path again.</p>"},{"location":"development/jschema/#structure-of-the-code","title":"Structure of the code","text":"<p>The <code>JSchema</code> Svelte component intializes a class named <code>FormManager</code>, that handles the following features:</p> <ul> <li>creates and stores an object (<code>root</code>) used to draw the form;</li> <li>provides the functions to create new form elements;</li> <li>attaches a <code>notifyChange()</code> function to each created form element; this function is used by each component to notify changes to the manager (e.g. the value of an input changes, a new element is added to an array, and so on), then the function dispatches a <code>change</code> event up to the <code>JSchema</code> component;</li> <li>wraps the <code>SchemaValidator</code> and provides a <code>validate()</code> function;</li> <li>provides a <code>getFormData()</code> function, that returns an object based on the data present in the form.</li> </ul> <p>The creation of the <code>root</code> object requires 2 preliminary steps, that are useful to reduce the complexity of the subsequent object creation:</p> <ol> <li>provided JSON Schema is adapted, to create a simpler but equivalent JSON Schema (<code>jschema_adapter.js</code>);</li> <li>an object representing the initial form data is created, considering both the provided data (if any) and the default values (<code>jschema_initial_data.js</code>).</li> </ol> <p>The <code>adaptJsonSchema()</code> function does the following:</p> <ol> <li>removes the properties to ignore (e.g. <code>zarr_url</code>, <code>zarr_urls</code>, <code>init_args</code>, <code>zarr_dir</code>);</li> <li>resolves and replaces the schema references (<code>$ref</code> fields pointing to definitions);</li> <li>merges the <code>allOf</code> items.</li> </ol> <p>The <code>getJsonSchemaData()</code> function initializes an object representing the initial form data. If the <code>initialValue</code> parameter is not set the created object is populated using the default values. If an <code>initialValue</code> object is provided, the function adds to it all the optional fields set to null (this is needed to have an object that acts as a complete skeleton for the form).</p> <p>Using the adapted JSON Schema and the computed data object, the <code>FormManager</code> populates the <code>root</code> object, initializing a dedicated class for each form element (<code>NumberFormElement</code>, <code>ArrayFormElement</code>, <code>BooleanFormElement</code>, ...). These classes contain fields that are specific to each form element type and may contain additional functions to manipulate them (e.g. <code>addChild</code>, <code>removeChild</code>). Functions that add new children delegate the creation to the <code>FormManager</code>, since it is the class having the knowledge to create form elements of any type, and then add the new child to an internal array of children.</p> <p>Each form element is mapped to a dedicated Svelte component (e.g. the <code>NumberFormElement</code> class is passed to a <code>NumberProperty.svelte</code> component). Each property component can contain additional functions for validating the input values and display the validation errors, but delegates to the wrapped form element class any additional logic.</p> <p>This structure attempts to achieve a greater separation of concerns, needed to handle properly such a complex component.</p>"},{"location":"development/precommit/","title":"Precommit","text":""},{"location":"development/precommit/#pre-commit-setup","title":"pre-commit setup","text":"<p>In your local folder, create a file <code>.git/hooks/pre-commit</code> with the following content</p> <pre><code>#!/bin/bash\nnpm run pre-commit\nRESULT=$?\n[ $RESULT -ne 0 ] &amp;&amp; exit 1\nexit 0\n</code></pre> <p>and make this file executable (<code>chmod +x .git/hooks/pre-commit</code>).</p> <p>In this way, <code>npm run pre-commit</code> will run before every commit. This script is defined in <code>package.json</code>, and points to <code>lint-staged</code>. The configuration is written in <code>.lintstagedrc.json</code>, and it lists the checks to perform on each kind of file (e.g. <code>eslint</code> and then <code>prettier</code>).</p>"},{"location":"development/release/","title":"Release","text":""},{"location":"development/release/#release","title":"Release","text":"<p>Steps to release a new <code>fractal-web</code> version:</p> <ul> <li>Update <code>CHANGELOG.md</code> on <code>main</code> branch, replacing the \"Unreleased\" temporary title with the desidered version number</li> <li>Update the <code>version-compatibility.md</code> doc page</li> <li>Commit the changes</li> <li>Execute <code>npm version &lt;major|minor|patch&gt;</code></li> <li>Execute <code>git push origin main</code></li> <li>Execute <code>git push origin &lt;new-version-tag&gt;</code></li> <li>Update the GitHub release page with the information from <code>CHANGELOG.md</code></li> </ul> <p>NOTE: Pushing a new version tag (like v5.6.7) triggers a dedicated GitHub action, which also creates build artifacts (based on <code>npm pack</code>) and attaches them to the GitHub release.</p>"},{"location":"development/setup/","title":"Development setup","text":""},{"location":"development/setup/#install-node","title":"Install node","text":"<p>Versions 18 or 20 of Node.js are recommended. See the quickstart for more details about how to install node.</p>"},{"location":"development/setup/#install-fractal-web-from-git-repository","title":"Install fractal-web from git repository","text":"<p>Clone this repository <pre><code>git clone https://github.com/fractal-analytics-platform/fractal-web.git\ncd fractal-web\n</code></pre> then optionally checkout to a specific version tag <pre><code>git checkout v0.6.0\n</code></pre> and finally install via <pre><code>cd components\nnpm install\ncd ..\nnpm install\n</code></pre></p>"},{"location":"development/setup/#set-environment-variables","title":"Set environment variables","text":"<p>To properly run fractal-web you have to configure some environment variables. The environment variables page contains the complete list of supported environment variables and their default values. It also includes some troubleshooting infomation about errors related to environment variables misconfiguration.</p> <p>When running the application from the git repository, environment variables are set either in <code>.env</code> or <code>.env.development</code> files, see vite documentation (briefly: <code>.env.development</code> is the relevant file when using <code>npm run dev</code> and <code>.env</code> is the relevant file when using <code>npm run preview</code>).</p> <p>You can also add your customizations in a file named <code>.env.local</code> or <code>.env.development.local</code> to avoid writing on env files that are under version control.</p>"},{"location":"development/setup/#run-fractal-web-from-git-repo","title":"Run fractal-web from git repo","text":"<p>For development, run the client application via</p> <pre><code>npm run dev\n</code></pre> <p>The application will run at <code>http://localhost:5173</code>.</p> <p>To test a production build, first execute</p> <pre><code>npm run build\n</code></pre> <p>And then</p> <pre><code>npm run preview\n</code></pre> <p>Also in this case the application runs at <code>http://localhost:5173</code>.</p>"},{"location":"development/structure/","title":"Code-base structure","text":"<p>This project is based on svelte kit and follows its conventions and structure.</p>"},{"location":"development/structure/#1-level-folders","title":"1-level folders","text":"<p>By default, the main application folder is located at <code>/src</code>. The structure of this folder is explained in depth in svelte kit docs</p> <p><code>/static</code> is a folder related to static files that will be served by the client server. More on this could be found in the svelte kit docs.</p> <p>The <code>/lib</code> folder contains files and sources that enable correct instrumentation and testing of this client application. Currently, within this folder are present files to support the project's unit tests arrangements and other library files to populate local instances of the fractal server in order to test the client.</p> <p>As for testing, currently, there are two folders <code>/__tests__</code> and <code>/tests</code>. The former contains files of unit tests executed by <code>vitest</code> and the latest is related to <code>playwright</code> testing. This structure could be improved and organized differently by updating project configuration files, specifically <code>vite.config.js</code> and <code>playwrght.config.js</code> which are located at project root.</p> <p><code>/examples</code> folder contains configuration guidance to set up local environments to test different fractal server / fractal web interoperability architectures.</p> <p><code>/docs</code> folder is the root of the project docs files.</p> <pre><code>[project root]\n\u251c /src\n\u251c /static\n\u251c /lib\n\u251c /__tests__\n\u251c /tests\n\u251c /examples\n\u251c /docs\n</code></pre>"},{"location":"development/structure/#application-structure","title":"Application structure","text":"<p>With reference to <code>/src/routes</code> folder, therein are defined svelte kit page components that structure the fractal web client.</p> <p>It is important to mention that, this client application is server-side rendered. By default, this is the default behaviour of svelte kit.</p> <p>Before proceeding, it is important to understand the distinction of files terminating with the suffix <code>+[.]server.js</code>. Those files are explicitly processed by the client's server.</p> <p>This client application is in essence a proxy that enables users to interact with a server application, the fractal server. Through the browser interface, the svelte application enable users to build HTTP requests that will be sent to the fractal server.</p> <p>The svelte client and fractal server interact through a REST interface.</p> <p>But how is this interaction implemented in this client?</p>"},{"location":"development/structure/#client-server-interoperability","title":"Client server interoperability","text":"<p>As said, the svelte client communicates with the fractal server through a set of REST APIs.</p> <p>In this client, every request to the fractal server is sent by the nodejs server that is serving the svelte application.</p> <p>It is important to understand that these requests are made in the server context of the svelte client. No request to the fractal server is sent directly by the browser of the user.</p> <p>The fact that every request on behalf of a user is sent through a common backend nodejs server, implies a proxy architecture. The way this works is the following: the svelte client in the browser sends a HTTP request to the nodejs server that is serving the application. This request, with the attached cookies, is then used to compose a new request to be sent to the fractal server.</p> <p>Note that the authentication context is kept thanks to cookies that establish user sessions.</p> <p>The following image provides an overview for the reader of the described architecture.</p> <p></p> <p>To avoid duplicating the logic of each fractal-server endpoint and simplify the error handling, a special Svelte route has been setup to act like a transparent proxy: <code>src/routes/api/[...path]/+server.js</code>. This is one of the suggested way to handle a different backend according to Svelte Kit FAQ.</p> <p>So, by default, the AJAX calls performed by the front-end have the same path and payload of the fractal-server API, but are sent to the Node.js Svelte back-end. Some Python API endpoints (like the <code>/auth</code> and <code>/admin</code> endpoints) that don't start with <code>/api</code> are handled in a slightly different way. Indeed, the <code>/api</code> prefix is needed by <code>hooks.server.js</code> to detect if the received call is an AJAX call, in order to process the token expiration in a custom way. To preserve this behavior for all the API calls these paths are rewritten adding the <code>/api</code> prefix.</p> <p>Summarizing, the frontend code:</p> <ul> <li>uses exactly the same path of the fractal-server API for the <code>/api</code> endpoints </li> <li>uses <code>/api/auth</code> for <code>/auth</code> endpoints</li> <li>uses <code>/api/admin</code> for <code>/admin</code> endpoints</li> </ul> <p>Other than the AJAX calls, there are also some calls to fractal-server API done by Svelte SSR, while generating the HTML page. These requests are defined in files under <code>src/lib/server/api/v1</code>. Here requests are grouped by contexts as <code>auth_api</code>, <code>admin_api</code>, [...].</p>"},{"location":"development/structure/#an-example-using-actions","title":"An example using actions","text":"<p>The login is still using the Svelte action approach, in which we have to extract the data from a formData object and then use it to build a JSON payload to be forwarded to fractal-server.</p> <p>Consider the code at <code>src/lib/server/api/auth_api.js:5</code>:</p> <pre><code>/**\n * Request to authenticate user\n * @param fetch\n * @param data\n * @returns {Promise&lt;*&gt;}\n */\nexport async function userAuthentication(fetch, data) {\nconst response = await fetch(FRACTAL_SERVER_HOST + '/auth/token/login', {\nmethod: 'POST',\ncredentials: 'include',\nmode: 'cors',\nbody: data\n});\n\nif (!response.ok) {\nthrow new Error('Authentication failed');\n}\n\nreturn await response.json();\n}\n</code></pre> <p>This code is responsible to call the <code>/auth/token/login</code> REST api endpoint of the fractal server. The request is made by the svelte client application in a backend context within the nodejs server.</p> <p>The client will, if the request succeeds, handle the fractal server response in a form action.</p> <pre><code>// src/routes/auth/login/+page.server.js\n\nexport const actions = {\n// Default page action / Handles POST requests\ndefault: async ({ request, cookies, fetch }) =&gt; {\n// TODO: Handle login request\nconsole.log('Login action');\n\n// Get form data\nconst formData = await request.formData();\n// Set auth data\nlet authData;\ntry {\nauthData = await userAuthentication(fetch, formData);\n} catch (error) {\nconsole.error(error);\nreturn fail(400, { invalidMessage: 'Invalid credentials', invalid: true });\n}\nconst authToken = authData.access_token;\n// Decode JWT token claims\nconst tokenClaims = jose.decodeJwt(authToken);\n\n// Set the authentication cookie\nconst cookieOptions = {\ndomain: `${AUTH_COOKIE_DOMAIN}`,\npath: `${AUTH_COOKIE_PATH}`,\nexpires: new Date(tokenClaims.exp * 1000),\nsameSite: `${AUTH_COOKIE_SAME_SITE}`,\nsecure: `${AUTH_COOKIE_SECURE}` === 'true',\nhttpOnly: `${AUTH_COOKIE_HTTP_ONLY}` === 'true'\n};\nconsole.log(cookieOptions);\ncookies.set(AUTH_COOKIE_NAME, authData.access_token, cookieOptions);\n\nredirect(302, '/');\n}\n};\n</code></pre> <p>The previous code is executed in the backend (as one could understand by the name of the file) and it basically provides a form action that allows a user to login.</p> <p>This kind of pattern, form actions, is widely used within the client application, as it enables the browser-side client application to request different actions the server-side should take.</p> <p>In this case, we briefly described the authentication flow of the svelte client application.</p> <p>Notice that the authentication and session of a user is managed through cookies. The client application requests a authentication token to the fractal server, which data is used to create another cookie that the nodejs server of the client application sends to the browser.</p> <p>The default action within the <code>+page.server.js</code> is requested through an HTTP request that the browser-side client app makes when a user sends an HTML from, for completion, the one defined in:</p> <pre><code>&lt;!-- src/routes/auth/login/+page.svelte --&gt;\n\n&lt;script&gt;\nexport let form;\nlet loginError = false;\n\nif (form?.invalid) {\nloginError = true;\n}\n&lt;/script&gt;\n\n&lt;div class='container'&gt;\n  &lt;div class='row'&gt;\n    &lt;h1&gt;Login&lt;/h1&gt;\n  &lt;/div&gt;\n  &lt;div class='row'&gt;\n    &lt;div class='col-md-4'&gt;\n      &lt;form method='POST'&gt;\n        &lt;div class='mb-3'&gt;\n          &lt;label for='userEmail' class='form-label'&gt;Email address&lt;/label&gt;\n          &lt;input\n            name='username'\n            type='email'\n            class=\"form-control {loginError ? 'is-invalid' : ''}\"\n            id='userEmail'\n            aria-describedby='emailHelp'\n            required\n          /&gt;\n          &lt;div id='emailHelp' class='form-text'&gt;The email you provided to the IT manager&lt;/div&gt;\n          &lt;div class='invalid-feedback'&gt;\n            {form?.invalidMessage}\n          &lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div class='mb-3'&gt;\n          &lt;label for='userPassword' class='form-label'&gt;Password&lt;/label&gt;\n          &lt;input name='password' type='password' class='form-control' id='userPassword' required /&gt;\n        &lt;/div&gt;\n        &lt;button class='btn btn-primary'&gt;Submit&lt;/button&gt;\n      &lt;/form&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/div&gt;\n</code></pre>"},{"location":"development/structure/#application-library","title":"Application library","text":"<p>While the <code>src/routes</code> is the public-facing side of the client application, <code>src/lib</code> contains the client internals.</p> <p>Within the lib are present four main sections: <code>common</code>, <code>components</code>, <code>server</code> and <code>stores</code>.</p> <p>Common contains client modules that export shared functionalities for both browser and server side parts of the app.</p> <p>Components contains all the svelte components definitions that are used within the client app. Components are organized by resources defined and managed by the fractal server.</p> <p>Server this is a special section as it is never shared and bundled into the package that a user receives in the browser. More info about this could be found in the svelte kit doc about server-only modules</p> <p>Stores are modules that export svelte store objects that are used by components to manage the state of the application.</p> <p>Note that stores are currently not well-organized or used due to the youth of the client.</p>"},{"location":"development/tests/","title":"Testing","text":""},{"location":"development/tests/#unit-tests","title":"Unit tests","text":"<p>Unit tests are performed via vitest, via the <code>test</code> script defined in <code>package.json</code>.</p>"},{"location":"development/tests/#end-to-end-testing","title":"End-to-end testing","text":"<p>E2E tests are done using playwright. They can be executed using the following command:</p> <pre><code>npx playwright test\n</code></pre> <p>To print Svelte webserver log set the environment variable <code>DEBUG=pw:webserver</code>.</p> <p>To execute the tests seeing the browser add the <code>--headed</code> flag or the <code>--debug</code> flag if you need to watch them step by step.</p> <p>OAuth2 test requires a running instance of dexidp test image and a fractal-server instance configured to use it.</p> <p>To skip OAuth2 test set the environment variable <code>SKIP_OAUTH_TEST</code> to <code>true</code>.</p> <p>To skip Pixi test set the environment variable <code>SKIP_PIXI_TEST</code> to <code>true</code>.</p> <p>To run the OAuth2 test locally add the following configuration to <code>.fractal_server.env</code>:</p> <pre><code>OAUTH_CLIENT_NAME=dexidp\nOAUTH_CLIENT_ID=client_test_web_id\nOAUTH_CLIENT_SECRET=client_test_web_secret\nOAUTH_REDIRECT_URL=http://localhost:5173/auth/login/oauth2/\nOAUTH_OIDC_CONFIG_ENDPOINT=http://127.0.0.1:5556/dex/.well-known/openid-configuration\n</code></pre> <p>And then start the test IdP container:</p> <pre><code>docker run -d --rm -p 5556:5556 ghcr.io/fractal-analytics-platform/oauth:0.1\n</code></pre>"},{"location":"development/tests/#coverage","title":"Coverage","text":"<p>Warning: code coverage results are not reliable at the moment</p> <p>Coverage for the unit tests:</p> <pre><code>npx vitest --coverage\n</code></pre> <p>Warning: coverage takes some time, since we are using the option <code>{ all: true }</code>.</p>"},{"location":"development/tests/#local-fractal-server-instance","title":"Local <code>fractal-server</code> instance","text":"<p>The <code>lib/fractal-server</code> folder includes basic instructions to get a local instance of <code>fractal-server</code> running.</p>"},{"location":"development/tests/#remote-fractal-server-instance","title":"Remote <code>fractal-server</code> instance","text":"<p>One could also test a local <code>fractal-web</code> instance with a remote <code>fractal-server</code> one. If SSH access is possible, then a command like <pre><code>REMOTE_PORT=8010\nLOCAL_PORT=8000\nREMOTE_USER=...\nREMOTE_HOST_IP=...\n\nssh $REMOTE_USER@$REMOTE_HOST_IP -L $LOCAL_PORT:127.0.0.1:$REMOTE_PORT -N\n</code></pre> should work and forward the remote port <code>REMOTE_PORT</code> to the <code>LOCAL_PORT</code> on localhost, so that <code>fractal-web</code> can use it from the local machine. Note that the required details for the <code>ssh -L</code> command may be different in each specific case, depending for instance on the <code>fractal-server</code> configuration (e.g the <code>--bind</code> argument of <code>gunicorn</code>), or on whether an additional proxy is needed to reach the remote host.</p>"}]}